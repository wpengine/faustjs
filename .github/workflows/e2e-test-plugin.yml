name: E2E Test Plugin
on: pull_request
jobs:
  e2e_test_plugin:
    timeout-minutes: 10
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Create Docker containers
        working-directory: plugins/wpe-headless
        run: docker-compose up -d
      - name: Sleep 30 seconds
        run: sleep 30
      - name: Setup Tests
        working-directory: plugins/wpe-headless
        run: docker exec $(docker-compose ps -q wordpress) init-e2e-tests.sh
      - name: Test
        working-directory: plugins/wpe-headless
        run: |
          docker \
            exec \
            -w /var/www/html/wp-content/plugins/wpe-headless \
            $(docker-compose ps -q wordpress) \
            vendor/bin/codecept run acceptance
