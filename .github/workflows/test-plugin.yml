name: Test Plugin
on: pull_request
jobs:
  test_plugin:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Create Docker Containers
      working-directory: ./plugins/wpe-headless
      run: docker-compose up -d
    - name: Sleep 30 seconds
      run: sleep 30
    - name: inspect
      working-directory: ./plugins/wpe-headless
      run: docker inspect $(docker-compose ps -q wordpress)
    - name: Setup Testing Framework
      working-directory: ./plugins/wpe-headless
      run: docker exec $(docker-compose ps -q wordpress) init-testing-environment.sh
    - name: Run unit tests
      working-directory: ./plugins/wpe-headless
      run: docker exec --workdir /var/www/html/wp-content/plugins/wpe-headless $(docker-compose ps -q wordpress) vendor/bin/phpunit
