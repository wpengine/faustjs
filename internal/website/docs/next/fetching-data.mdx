---
id: next-fetching-data
slug: fetching-data
title: Faust.js makes fetching data from Headless WordPress incredibly easy with GQless.
---

# Fetching Data With Faust.js

> **NOTE**: If you followed the instructions in the [Getting Started with Next.js](getting-started.mdx) guide, you already have a working instance of the client. The following guide assumes you are setting up a client on an already existing application.

Faust.js uses [GQless](https://gqless.com/react/fetching-data) as the primary way to fetch data from Headless WordPress. GQless is a [proxy-based](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy) GraphQL client. GQless [preforms an invisible or skeleton render](https://gqless.com/intro/how-it-works) to identify what data is needed.

## Setting Up Your Client

GQless works primarily based on TypeScript typings that are generated using introspection on your GraphQL API. If you are using WPGraphQL as your Headless WordPress API, you can enable introspection and then generate typings for GQless. You will need to do the following:

1. Run `npm install -D @gqless/cli dotenv`
1. Create a `generate` script in your `package.json` that runs `gqless generate`
1. Create a `gqless.config.js` file in the root of your project. Use the following example config:

   ```js
   const dotenv = require('dotenv');

   dotenv.config({
     path: '.env.local',
   });

   /**
    * @type {import("@gqless/cli").GQlessConfig}
    */
   const config = {
     react: false,
     scalarTypes: { DateTime: 'string' },
     introspection: {
       endpoint: `${
         process.env.NEXT_PUBLIC_WORDPRESS_URL ?? process.env.WORDPRESS_URL
       }/graphql`,
       headers: {},
     },
     destination: './src/client/index.ts',
     subscriptions: false,
     javascriptOutput: false,
   };

   module.exports = config;
   ```

1. Run `npm run generate`

If everything runs smoothly you will end up with an `index.ts` and `schema.generated.ts` file in your `src/client` directory. The `index.ts` file contains your client code and the `schema.generated.ts` file contains the typings for GQless. You can use the client as-is, but you will not get some of the benefits that Faust.js provides on top of the standard GQless client. In order to use Faust.js with your Headless WordPress API, you will need to add some additional functionality. Replace the contents of `index.ts` with the following:

```ts
/**
 * GQLESS: You can safely modify this file and Query Fetcher based on your needs
 */
import type { IncomingMessage } from 'http';
import { getClient } from '@faustjs/next';
import {
  generatedSchema,
  scalarsEnumsHash,
  GeneratedSchema,
  SchemaObjectTypes,
  SchemaObjectTypesNames,
} from './schema.generated';

export const client = getClient<
  GeneratedSchema,
  SchemaObjectTypesNames,
  SchemaObjectTypes
>({
  schema: generatedSchema,
  scalarsEnumsHash,
});

export function serverClient(req: IncomingMessage) {
  return getClient<GeneratedSchema, SchemaObjectTypesNames, SchemaObjectTypes>({
    schema: generatedSchema,
    scalarsEnumsHash,
    context: req,
  });
}

export * from './schema.generated';
```

The code above is a modified version of the default `index.ts` file that is generated by GQless. The `getClient` function is a helper function that returns a client that is configured to work with the Headless WordPress API. Note the additional `serverClient` function that is used to create a client that is configured to work with the server by passing in the `IncomingMessage` object. This allows Faust.js to read cookies on the server and pass them along to the Headless WordPress API.

## Updating Your Schema Typings

If you followed the steps above, or you started a project using the `examples/next/getting-started` boilerplate you will have a `schema.generated.ts` file in your `src/client` directory. The typings in this file are generated from the Headless WordPress API. If you are using a different Headless WordPress API or you add additional queries or mutations to your existing Headless WordPress API, you will need to update the typings in this file. Possible reasons you might need to generate a new typings file include:

1. Adding a plugin to your WordPress site that adds additional queries
1. Using plugins like [`Atlas Content Modeler`](https://github.com/wpengine/atlas-content-modeler) that add additional queries based on custom content types you create

To do this you will need to run `gqless generate` again. Running `gqless generate` will update the typings in the `schema.generated.ts` file and leave the `index.ts` unchanged.

## Providing Your GQless Client To Faust.js

Using the boilerplate client code will provide two different GQless clients that you can use depending upon whether you are on the client or server. However, you will still need to provide the client to Faust.js so that it can use it to fetch data. To do this you can use the `HeadlessProvider` component published by Faust.js, and provide it the GQless client you want to use. This is done in your `_app.tsx` file as follows:

```tsx title="src/pages/_app.tsx" {2,3,14,16}
import { headlessConfig } from '@faustjs/core';
import { HeadlessProvider } from '@faustjs/next';
import { client } from 'client';
import { AppProps } from 'next/dist/next-server/lib/router/router';

headlessConfig({
  wpUrl: process.env.WORDPRESS_URL || process.env.NEXT_PUBLIC_WORDPRESS_URL,
  apiClientSecret: process.env.WP_HEADLESS_SECRET,
});

export default function MyApp({ Component, pageProps }: AppProps) {
  return (
    <>
      <HeadlessProvider client={client} pageProps={pageProps}>
        <Component {...pageProps} />
      </HeadlessProvider>
    </>
  );
}
```

This will ensure Faust.js uses the correct client to make requests on your behalf.

## Troubleshooting

### "GraphQL introspection is not allowed"

If you run into the error message `GraphQL introspection is not allowed, but the query contained __schema or __type`, you will have to temporarily enable introspection.

[Introspection is disabled by default in WPGraphQL.](https://www.wpgraphql.com/docs/security/#introspection-disabled-by-default) To enable it, go to WP Admin -> GraphQL -> Enable Public Introspection.

If you are using something other than `WPGraphQL` you will need to refer to the documentation on how to enable introspection.

Once the schema file has been generated, you can then disable introspection again.
